import{F as O,L as D,N as $,P as M,_ as V,b as K,E as R,a as U}from"./comp-libs-T7Am_QBI.js";import{u as j}from"./useRequestList-_ZCgWszA.js";/* empty css              */import{d as H,i as z,r as m,c as A,h as w,l,M as f,_ as s,u as r,J as G,K as Q,F as S,N as W,B as v,f as _,p as X}from"./vue-vendor-13TjpPhz.js";import{d as Y,f as Z,h as I,i as ee}from"./api-libs-Yru0OYFh.js";import{g as te,M as y}from"./comp-vendor-Va0SXYoc.js";import{u as se}from"./locale-vendor-LTacbNcc.js";import"../assets/index-G1g0hvo6.js";const oe={class:"notes-page flex flex-col h-full"},ne={class:"layout-title"},ae={class:"label-bar flex items-center"},le={class:"flex"},ie={class:"mr-4"},re={class:"note-list flex-1 relative"},ce=H({__name:"notes",setup(ue){const{t:o}=se(),t=z("emitter"),C=m(["123","234"]),c=m(!1),d=m({}),g=m("");let h=!1,p="";const{list:L,loading:x,total:B,queryParams:i,forceUpdate:N}=j(Y),F=A(()=>L.value.map(e=>({...e,content:e.desc.replace(/{{ENTER}}/g,"\n"),topics:e.tags})));function P(e){const{searchText:n,filterCondition:u}=e;let a=!1;i.query!=n&&(i.query=n,a=!0),i.queryType!=u&&(i.queryType=u,a=!0),a&&(i.current=1)}function E(){g.value=o("notes.formTitle.newNote"),d.value={},p="",h=!0,c.value=!0}function k(e){g.value=o("notes.formTitle.editNote"),d.value=e,p=JSON.stringify(e),h=!1,c.value=!0}async function b(e){console.log("noteInfo",e),t==null||t.emit("fullScreenLoading:show"),h?(await Z({...e,status:"create"}).then(()=>{y.success(o("notes.response.saveNoteSuccess"))}),N()):(await I({id:d.value.id,...e,status:"save"}).then(()=>{y.success(o("notes.response.saveNoteSuccess"))}),N(i.current)),c.value=!1,t==null||t.emit("fullScreenLoading:hide")}async function T(e){p!=JSON.stringify(e)&&await b({...e,status:"publish"}),console.log("currentNoteBak",p),console.log("JSON.stringify(noteInfo)",JSON.stringify(e)),t==null||t.emit("fullScreenLoading:show"),console.log("publish"),window.dispatchEvent(new CustomEvent("@p/aprbn:setPublishData",{detail:{data:{type:"word",title:e.title,content:e.content,topics:e.topics}}})),t==null||t.emit("fullScreenLoading:hide")}function q(e){t==null||t.emit("fullScreenLoading:show"),console.log("deleteNote",e),ee({id:e.id}).then(()=>{y.success(o("notes.response.deleteNoteSuccess")),t==null||t.emit("fullScreenLoading:hide"),N(i.current)})}function J(e){const{commodityInfo:n,...u}=e;return JSON.stringify(u)}return(e,n)=>{const u=te;return _(),w(S,null,[l("section",oe,[l("section",ne,[l("span",null,f(s(o)("notes.title")),1)]),r(s(O),{onChange:P,placeholder:s(o)("notes.searchPlaceHolder"),filterConditionList:C.value},null,8,["placeholder","filterConditionList"]),l("div",ae,[l("span",le,f(s(o)("notes.label.info")),1),l("span",ie,f(s(o)("notes.label.desc")),1),l("span",null,f(s(o)("notes.label.commodityInfo")),1),l("span",null,f(s(o)("notes.label.operate")),1)]),l("section",re,[G(r(s(D),{"blur-bg":!0},null,512),[[Q,s(x)]]),(_(!0),w(S,null,W(F.value,a=>(_(),X(s($),{key:J(a),"note-info":a,onPublishNote:k,onDeleteNote:q},null,8,["note-info"]))),128))]),r(s(K),{"current-page":s(i).current,"onUpdate:currentPage":n[0]||(n[0]=a=>s(i).current=a),total:s(B)},{left:v(()=>[r(s(M),{onClick:E},{default:v(()=>[r(s(V),{name:"plus"}),l("span",null,f(s(o)("notes.createNoteBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),r(u,{visible:c.value,footer:!1,placement:"right",unmountOnClose:"",title:g.value,onCancel:n[2]||(n[2]=a=>c.value=!1)},{default:v(()=>[r(s(R),{"note-info":d.value,onCancel:n[1]||(n[1]=a=>c.value=!1),onPublish:T,onSave:b},null,8,["note-info"])]),_:1},8,["visible","title"])],64)}}}),_e=U(ce,[["__scopeId","data-v-f12ef943"]]);export{_e as default};
