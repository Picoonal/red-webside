import{F as G,L as k,C as I,P as O,_ as T,b as V,c as D,G as J,a as M}from"./comp-libs-JCqQq8sh.js";import{u as R}from"./useRequestList-x7quB3a-.js";import{a as U}from"./index.es-RSAZJdtD.js";import{a9 as W,d as w,w as E,e as H,X as j,i as z,r as y,h as b,l as f,M as L,$ as e,u as s,J as A,K,F as N,N as X,B as g,f as _,p as Q}from"./vue-vendor-eR5EHmMR.js";import{g as Y,e as Z,b as ee,d as te,f as oe}from"./api-libs-Y_MbP9z_.js";import{h as ne,M as S}from"./comp-vendor-MLbRUMP8.js";import{u as ae}from"./locale-vendor-85zrdMqj.js";import"../assets/index-axPTNcD5.js";function ie(v,i,o=1e3*60){const c=document.createElement("div");document.body.appendChild(c);const l=W(w(()=>{const{data:r,run:m,cancel:C}=U(Y,{pollingInterval:o,pollingWhenHidden:!0,pollingWhenOffline:!0,manual:!0}),h=E(r,()=>{var p;((p=r.value)==null?void 0:p.code)=="0"&&(Z.emit("message:noteGenerateSuccess",v),C(),l.unmount(),c.remove())});return m({id:i}),H(()=>{console.log("unmounted polling"),h()}),()=>j(v.name)}));l.mount(c)}const se={class:"commodity-page flex flex-col h-full"},le={class:"layout-title"},re={class:"commodity-list flex-1 z-0"},me=w({__name:"commodity",setup(v){const{t:i}=ae(),o=z("emitter"),c=y(["commodity.id","commodity.name","commodity.brand"]),l=y(!1),r=y(!1),m=y({}),{list:C,loading:h,total:p,queryParams:u,forceUpdate:$}=R(ee);function B(a){const{searchText:t,filterCondition:d}=a;let n=!1;u.query!=t&&(u.query=t,n=!0),u.queryType!=d&&(u.queryType=d,n=!0),n&&(u.current=1)}function q(){l.value=!0}function x(a){console.log("commodityData",a),o==null||o.emit("fullScreenLoading:show"),te(a).then(()=>{l.value=!1,o==null||o.emit("fullScreenLoading:hide"),S.success(i("commodity.response.createCommoditySuccess")),$()})}function F(a){m.value=a,r.value=!0}function P(a){console.log("noteData",a),o==null||o.emit("fullScreenLoading:show"),oe({...a,commodityBrand:m.value.brand,commodityId:m.value.id}).then(t=>{r.value=!1,o==null||o.emit("fullScreenLoading:hide"),S.info(i("commodity.response.generateNoteInfo")),ie(JSON.parse(JSON.stringify(m.value)),t.data.id)})}return(a,t)=>{const d=ne;return _(),b(N,null,[f("section",se,[f("section",le,[f("span",null,L(e(i)("commodity.title")),1)]),s(e(G),{onChange:B,placeholder:e(i)("commodity.searchPlaceHolder"),filterConditionList:c.value},null,8,["placeholder","filterConditionList"]),f("section",re,[A(s(e(k),{"blur-bg":!0},null,512),[[K,e(h)]]),(_(!0),b(N,null,X(e(C),n=>(_(),Q(e(I),{key:n.id,"commodity-info":n,onCreateNote:F},null,8,["commodity-info"]))),128))]),s(e(V),{"current-page":e(u).current,"onUpdate:currentPage":t[0]||(t[0]=n=>e(u).current=n),total:e(p)},{left:g(()=>[s(e(O),{onClick:q},{default:g(()=>[s(e(T),{name:"plus"}),f("span",null,L(e(i)("commodity.createCommodityBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),s(d,{visible:l.value,footer:!1,placement:"right",unmountOnClose:"",title:e(i)("commodity.formTitle.createCommodity"),onCancel:t[2]||(t[2]=n=>l.value=!1)},{default:g(()=>[s(e(D),{onSubmit:x,onCancel:t[1]||(t[1]=n=>l.value=!1)})]),_:1},8,["visible","title"]),s(d,{visible:r.value,footer:!1,placement:"right",unmountOnClose:"",title:e(i)("commodity.formTitle.generateNote"),onCancel:t[4]||(t[4]=n=>r.value=!1)},{default:g(()=>[s(e(J),{"commodity-info":m.value,onSubmit:P,onCancel:t[3]||(t[3]=n=>r.value=!1)},null,8,["commodity-info"])]),_:1},8,["visible","title"])],64)}}}),Ce=M(me,[["__scopeId","data-v-63f800e9"]]);export{Ce as default};
