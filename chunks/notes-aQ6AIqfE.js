import{F as z,L as A,N as W,P as G,_ as Q,b as X,c as Z,a as ee}from"./comp-libs-hM04ODlz.js";import{u as te}from"./useRequestList-vfP09r0x.js";import"../assets/index-E8y6VTV3.js";import{d as oe,i as se,r as h,c as ne,h as C,l as f,M as g,$ as o,u as i,J as ae,K as le,F as P,N as ie,B as m,f as T,p as re,x}from"./vue-vendor-Ewu5EBAq.js";import{j as ue,k as ce,m as de,n as fe}from"./api-libs-1XXty04u.js";import{h as me,i as pe,M as L,O as ve,S as ge,F as _e,j as be,b as he}from"./comp-vendor-oDlW8gRb.js";import{u as ye}from"./locale-vendor-npigJYsg.js";const Ne={class:"notes-page flex flex-col h-full"},we={class:"layout-title"},De={class:"label-bar flex items-center"},Me={class:"flex"},Te={class:"mr-4"},Le={class:"note-list flex-1 z-0"},Se=oe({__name:"notes",setup(Ce){const{t:n}=ye(),s=se("emitter"),F=h(["note.id","note.title","commodity.id","commodity.name"]),b=h(!1),c=h({}),N=h("");let w=!1,D="";const y=h(!1),{list:k,loading:V,total:B,queryParams:p,forceUpdate:M}=te(ue),E=ne(()=>k.value.map(e=>({...e,date:"",type:"word",content:e.desc.replace(/{{ENTER}}/g,"\n"),topics:e.tags})));function H(e){const{searchText:t,filterCondition:l}=e;let a=!1;p.query!=t&&(p.query=t,a=!0),p.queryType!=l&&(p.queryType=l,a=!0),a&&(p.current=1)}function O(){N.value=n("notes.formTitle.newNote"),c.value={},D="",w=!0,b.value=!0}function $(e){N.value=n("notes.formTitle.editNote"),c.value=e,D=JSON.stringify({title:e.title,content:e.content,topics:e.topics}),w=!1,b.value=!0}async function S(e){console.log("noteInfo",e),s==null||s.emit("fullScreenLoading:show"),w?(await ce({...e,status:"create"}).then(()=>{L.success(n("notes.response.saveNoteSuccess"))}),M()):(await de({id:c.value.id,...e,status:"save"}).then(()=>{L.success(n("notes.response.saveNoteSuccess"))}),M(p.current)),b.value=!1,s==null||s.emit("fullScreenLoading:hide")}async function q(e){const t=JSON.stringify({title:e.title,content:e.content,topics:e.topics});D!=t&&await S({...e,status:"publish"}),s==null||s.emit("fullScreenLoading:show"),console.log("publish"),U(),s==null||s.emit("fullScreenLoading:hide")}function U(){y.value=!0}function R(){const e=c.value;window.dispatchEvent(new CustomEvent("@p/aprbn:setPublishData",{detail:{data:{type:e.type,title:e.title,content:e.desc.replace(/{{ENTER}}/g,"<br />"),topics:e.topics,date:e.date}}}))}function J(e){s==null||s.emit("fullScreenLoading:show"),console.log("deleteNote",e),fe({id:e.id}).then(()=>{L.success(n("notes.response.deleteNoteSuccess")),s==null||s.emit("fullScreenLoading:hide"),M(p.current)})}function Y(e){const{commodityInfo:t,...l}=e;return JSON.stringify(l)}function j(e){const t=new Date;t.setHours(0,0,0,0);const l=new Date(e);l.setHours(0,0,0,0);const u=(l.getTime()-t.getTime())/(1e3*3600*24);return u<0||u>7}const I=function(){const e=(l,a)=>{const u=[];for(let d=l;d<a;d++)u.push(d);return u},t=l=>{const a=new Date,u=l.getDate(),d=a.getDate();var v=[];if(u===d){const _=new Date(a.getTime()+36e5);v=[[0,0],[_.getHours(),_.getMinutes()+1]]}else{const _=new Date(a.getTime()+6048e5);u===_.getDate()&&l.getMonth()===_.getMonth()?v=[[a.getHours(),a.getMinutes()],[24,60]]:v=[[0,0],[0,0]]}return v};return l=>{const[[a,u],[d,v]]=t(l);return{disabledHours:()=>e(a,d),disabledMinutes:()=>e(u,v)}}}();return(e,t)=>{const l=me,a=ve,u=ge,d=_e,v=be,_=he,K=pe;return T(),C(P,null,[f("section",Ne,[f("section",we,[f("span",null,g(o(n)("notes.title")),1)]),i(o(z),{onChange:H,placeholder:o(n)("notes.searchPlaceHolder"),filterConditionList:F.value},null,8,["placeholder","filterConditionList"]),f("div",De,[f("span",Me,g(o(n)("notes.label.info")),1),f("span",Te,g(o(n)("notes.label.desc")),1),f("span",null,g(o(n)("notes.label.commodityInfo")),1),f("span",null,g(o(n)("notes.label.operate")),1)]),f("section",Le,[ae(i(o(A),{"blur-bg":!0},null,512),[[le,o(V)]]),(T(!0),C(P,null,ie(E.value,r=>(T(),re(o(W),{key:Y(r),"note-info":r,onPublishNote:$,onDeleteNote:J},null,8,["note-info"]))),128))]),i(o(X),{"current-page":o(p).current,"onUpdate:currentPage":t[0]||(t[0]=r=>o(p).current=r),total:o(B)},{left:m(()=>[i(o(G),{onClick:O},{default:m(()=>[i(o(Q),{name:"plus"}),f("span",null,g(o(n)("notes.createNoteBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),i(l,{visible:b.value,footer:!1,placement:"right",unmountOnClose:"",title:N.value,onCancel:t[2]||(t[2]=r=>b.value=!1)},{default:m(()=>[i(o(Z),{"note-info":c.value,onCancel:t[1]||(t[1]=r=>b.value=!1),onPublish:q,onSave:S},null,8,["note-info"])]),_:1},8,["visible","title"]),i(K,{visible:y.value,"onUpdate:visible":t[5]||(t[5]=r=>y.value=r),title:o(n)("notes.publishInfoModelTitle"),onCancel:t[6]||(t[6]=r=>y.value=!1),onOk:R},{default:m(()=>[i(_,{model:c.value},{default:m(()=>[i(d,{field:"type",label:o(n)("notes.noteModel.typeLabel")},{default:m(()=>[i(u,{modelValue:c.value.type,"onUpdate:modelValue":t[3]||(t[3]=r=>c.value.type=r)},{default:m(()=>[i(a,{value:"word"},{default:m(()=>[x(g(o(n)("notes.noteModel.type.word")),1)]),_:1}),i(a,{value:"video"},{default:m(()=>[x(g(o(n)("notes.noteModel.type.video")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(d,{field:"date",label:o(n)("notes.noteModel.dateLabel")},{default:m(()=>[i(v,{modelValue:c.value.date,"onUpdate:modelValue":t[4]||(t[4]=r=>c.value.date=r),"show-time":"",format:"YYYY-MM-DD hh:mm",timePickerProps:{hideDisabledOptions:!0},disabledDate:j,disabledTime:o(I)},null,8,["modelValue","disabledTime"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}}),He=ee(Se,[["__scopeId","data-v-225c58ff"]]);export{He as default};
