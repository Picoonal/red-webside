import{F as z,L as A,N as H,P as G,_ as I,b as Q,E as W,a as X}from"./comp-libs-qzLOwOZ7.js";import{u as Y}from"./useRequestList-72nUBOHJ.js";import"./index.es-hgNGnXbL.js";import{d as Z,i as ee,r as v,c as te,h as C,l as i,M as d,_ as t,u as l,J as oe,K as se,F as L,N as ne,B as c,f as b,p as le,x as F}from"./vue-vendor-RO-sxRw_.js";import{d as ae,f as ie,h as re,i as ce}from"./api-libs-BNhwcwzX.js";import{g as ue,h as de,M as w,O as fe,S as pe,F as me,c as ve}from"./comp-vendor-uyqe4vcM.js";import{u as _e}from"./locale-vendor-bbW5XbFs.js";const Ne={class:"notes-page flex flex-col h-full"},ge={class:"layout-title"},he={class:"label-bar flex items-center"},ye={class:"flex"},be={class:"mr-4"},we={class:"note-list flex-1 z-0"},Se=Z({__name:"notes",setup(Ce){const{t:n}=_e(),o=ee("emitter"),x=v(["note.id","note.title","commodity.id","commodity.name"]),f=v(!1),u=v({}),N=v("");let g=!1,h="";const _=v(!1),{list:T,loading:M,total:P,queryParams:r,forceUpdate:y}=Y(ae),B=te(()=>T.value.map(e=>({...e,type:"word",content:e.desc.replace(/{{ENTER}}/g,"\n"),topics:e.tags})));function E(e){const{searchText:s,filterCondition:p}=e;let m=!1;r.query!=s&&(r.query=s,m=!0),r.queryType!=p&&(r.queryType=p,m=!0),m&&(r.current=1)}function V(){N.value=n("notes.formTitle.newNote"),u.value={},h="",g=!0,f.value=!0}function k(e){N.value=n("notes.formTitle.editNote"),u.value=e,h=JSON.stringify({title:e.title,content:e.content,topics:e.topics}),g=!1,f.value=!0}async function S(e){console.log("noteInfo",e),o==null||o.emit("fullScreenLoading:show"),g?(await ie({...e,status:"create"}).then(()=>{w.success(n("notes.response.saveNoteSuccess"))}),y()):(await re({id:u.value.id,...e,status:"save"}).then(()=>{w.success(n("notes.response.saveNoteSuccess"))}),y(r.current)),f.value=!1,o==null||o.emit("fullScreenLoading:hide")}async function O(e){const s=JSON.stringify({title:e.title,content:e.content,topics:e.topics});h!=s&&await S({...e,status:"publish"}),o==null||o.emit("fullScreenLoading:show"),console.log("publish"),q(),o==null||o.emit("fullScreenLoading:hide")}function q(){_.value=!0}function $(){const e=u.value;window.dispatchEvent(new CustomEvent("@p/aprbn:setPublishData",{detail:{data:{type:e.type,title:e.title,content:e.content,topics:e.topics}}}))}function D(e){o==null||o.emit("fullScreenLoading:show"),console.log("deleteNote",e),ce({id:e.id}).then(()=>{w.success(n("notes.response.deleteNoteSuccess")),o==null||o.emit("fullScreenLoading:hide"),y(r.current)})}function J(e){const{commodityInfo:s,...p}=e;return JSON.stringify(p)}return(e,s)=>{const p=ue,m=fe,U=pe,K=me,R=ve,j=de;return b(),C(L,null,[i("section",Ne,[i("section",ge,[i("span",null,d(t(n)("notes.title")),1)]),l(t(z),{onChange:E,placeholder:t(n)("notes.searchPlaceHolder"),filterConditionList:x.value},null,8,["placeholder","filterConditionList"]),i("div",he,[i("span",ye,d(t(n)("notes.label.info")),1),i("span",be,d(t(n)("notes.label.desc")),1),i("span",null,d(t(n)("notes.label.commodityInfo")),1),i("span",null,d(t(n)("notes.label.operate")),1)]),i("section",we,[oe(l(t(A),{"blur-bg":!0},null,512),[[se,t(M)]]),(b(!0),C(L,null,ne(B.value,a=>(b(),le(t(H),{key:J(a),"note-info":a,onPublishNote:k,onDeleteNote:D},null,8,["note-info"]))),128))]),l(t(Q),{"current-page":t(r).current,"onUpdate:currentPage":s[0]||(s[0]=a=>t(r).current=a),total:t(P)},{left:c(()=>[l(t(G),{onClick:V},{default:c(()=>[l(t(I),{name:"plus"}),i("span",null,d(t(n)("notes.createNoteBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),l(p,{visible:f.value,footer:!1,placement:"right",unmountOnClose:"",title:N.value,onCancel:s[2]||(s[2]=a=>f.value=!1)},{default:c(()=>[l(t(W),{"note-info":u.value,onCancel:s[1]||(s[1]=a=>f.value=!1),onPublish:O,onSave:S},null,8,["note-info"])]),_:1},8,["visible","title"]),l(j,{visible:_.value,"onUpdate:visible":s[4]||(s[4]=a=>_.value=a),title:"Modal Form",onCancel:s[5]||(s[5]=a=>_.value=!1),onOk:$},{default:c(()=>[l(R,{model:u.value},{default:c(()=>[l(K,{field:"type",label:t(n)("notes.noteModel.label")},{default:c(()=>[l(U,{modelValue:u.value.type,"onUpdate:modelValue":s[3]||(s[3]=a=>u.value.type=a)},{default:c(()=>[l(m,{value:"word"},{default:c(()=>[F(d(t(n)("notes.noteModel.type.word")),1)]),_:1}),l(m,{value:"video"},{default:c(()=>[F(d(t(n)("notes.noteModel.type.video")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}}),Ee=X(Se,[["__scopeId","data-v-b6b99c3d"]]);export{Ee as default};
