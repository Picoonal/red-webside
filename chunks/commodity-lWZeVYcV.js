import{F as G,L as k,C as I,P as O,_ as T,b as U,c as V,G as D,a as J}from"./comp-libs-qzLOwOZ7.js";import{u as M}from"./useRequestList-72nUBOHJ.js";import{g as R}from"./index.es-hgNGnXbL.js";import{a2 as W,d as w,w as E,e as H,U as j,i as z,r as y,h as b,l as f,M as L,_ as e,u as s,J as A,K,F as N,N as Q,B as g,f as _,p as X}from"./vue-vendor-RO-sxRw_.js";import{g as Y,e as Z,a as ee,c as te,b as oe}from"./api-libs-BNhwcwzX.js";import{g as ne,M as S}from"./comp-vendor-uyqe4vcM.js";import{u as ae}from"./locale-vendor-bbW5XbFs.js";function ie(v,i,o=1e3*60){const c=document.createElement("div");document.body.appendChild(c),W(w(()=>{const{data:l,run:r,cancel:C}=R(Y,{pollingInterval:o,pollingWhenHidden:!0,pollingWhenOffline:!0,manual:!0}),h=E(l,()=>{var p;((p=l.value)==null?void 0:p.code)=="0"&&(Z.emit("message:noteGenerateSuccess",v),C(),c.remove())});return r({id:i}),H(()=>{console.log("unmounted polling"),h()}),()=>j(v.name)})).mount(c)}const se={class:"commodity-page flex flex-col h-full"},le={class:"layout-title"},re={class:"commodity-list flex-1 z-0"},me=w({__name:"commodity",setup(v){const{t:i}=ae(),o=z("emitter"),c=y(["commodity.id","commodity.name","commodity.brand"]),u=y(!1),l=y(!1),r=y({}),{list:C,loading:h,total:p,queryParams:m,forceUpdate:B}=M(ee);function $(a){const{searchText:t,filterCondition:d}=a;let n=!1;m.query!=t&&(m.query=t,n=!0),m.queryType!=d&&(m.queryType=d,n=!0),n&&(m.current=1)}function q(){u.value=!0}function x(a){console.log("commodityData",a),o==null||o.emit("fullScreenLoading:show"),te(a).then(()=>{u.value=!1,o==null||o.emit("fullScreenLoading:hide"),S.success(i("commodity.response.createCommoditySuccess")),B()})}function F(a){r.value=a,l.value=!0}function P(a){console.log("noteData",a),o==null||o.emit("fullScreenLoading:show"),oe({...a,commodityBrand:r.value.brand,commodityId:r.value.id}).then(t=>{l.value=!1,o==null||o.emit("fullScreenLoading:hide"),S.info(i("commodity.response.generateNoteInfo")),ie(JSON.parse(JSON.stringify(r.value)),t.data.id)})}return(a,t)=>{const d=ne;return _(),b(N,null,[f("section",se,[f("section",le,[f("span",null,L(e(i)("commodity.title")),1)]),s(e(G),{onChange:$,placeholder:e(i)("commodity.searchPlaceHolder"),filterConditionList:c.value},null,8,["placeholder","filterConditionList"]),f("section",re,[A(s(e(k),{"blur-bg":!0},null,512),[[K,e(h)]]),(_(!0),b(N,null,Q(e(C),n=>(_(),X(e(I),{key:n.id,"commodity-info":n,onCreateNote:F},null,8,["commodity-info"]))),128))]),s(e(U),{"current-page":e(m).current,"onUpdate:currentPage":t[0]||(t[0]=n=>e(m).current=n),total:e(p)},{left:g(()=>[s(e(O),{onClick:q},{default:g(()=>[s(e(T),{name:"plus"}),f("span",null,L(e(i)("commodity.createCommodityBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),s(d,{visible:u.value,footer:!1,placement:"right",unmountOnClose:"",title:e(i)("commodity.formTitle.createCommodity"),onCancel:t[2]||(t[2]=n=>u.value=!1)},{default:g(()=>[s(e(V),{onSubmit:x,onCancel:t[1]||(t[1]=n=>u.value=!1)})]),_:1},8,["visible","title"]),s(d,{visible:l.value,footer:!1,placement:"right",unmountOnClose:"",title:e(i)("commodity.formTitle.generateNote"),onCancel:t[4]||(t[4]=n=>l.value=!1)},{default:g(()=>[s(e(D),{"commodity-info":r.value,onSubmit:P,onCancel:t[3]||(t[3]=n=>l.value=!1)},null,8,["commodity-info"])]),_:1},8,["visible","title"])],64)}}}),ve=J(me,[["__scopeId","data-v-63f800e9"]]);export{ve as default};
