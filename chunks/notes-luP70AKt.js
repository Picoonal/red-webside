import{F as z,L as A,N as W,P as G,_ as Q,b as X,E as Z,a as ee}from"./comp-libs-ORwclTd6.js";import{u as te}from"./useRequestList-XbDUOjzQ.js";import"./index.es-RSAZJdtD.js";import{d as oe,i as ne,r as b,c as se,h as C,l as f,M as g,$ as o,u as i,J as ae,K as le,F as P,N as ie,B as p,f as L,p as re,x}from"./vue-vendor-eR5EHmMR.js";import{h as ue,i as ce,j as de,k as fe}from"./api-libs-Y_MbP9z_.js";import{h as pe,i as me,M as T,O as ve,S as ge,F as _e,j as he,b as be}from"./comp-vendor-MLbRUMP8.js";import{u as ye}from"./locale-vendor-DvyN9tVz.js";import"../assets/index-zC5Q-Gmn.js";const Ne={class:"notes-page flex flex-col h-full"},we={class:"layout-title"},De={class:"label-bar flex items-center"},Me={class:"flex"},Le={class:"mr-4"},Te={class:"note-list flex-1 z-0"},Se=oe({__name:"notes",setup(Ce){const{t:s}=ye(),n=ne("emitter"),k=b(["note.id","note.title","commodity.id","commodity.name"]),h=b(!1),c=b({}),N=b("");let w=!1,D="";const y=b(!1),{list:F,loading:V,total:B,queryParams:m,forceUpdate:M}=te(ue),H=se(()=>F.value.map(e=>({...e,date:"",type:"word",content:e.desc.replace(/{{ENTER}}/g,"\n"),topics:e.tags})));function E(e){const{searchText:t,filterCondition:l}=e;let a=!1;m.query!=t&&(m.query=t,a=!0),m.queryType!=l&&(m.queryType=l,a=!0),a&&(m.current=1)}function O(){N.value=s("notes.formTitle.newNote"),c.value={},D="",w=!0,h.value=!0}function $(e){N.value=s("notes.formTitle.editNote"),c.value=e,D=JSON.stringify({title:e.title,content:e.content,topics:e.topics}),w=!1,h.value=!0}async function S(e){console.log("noteInfo",e),n==null||n.emit("fullScreenLoading:show"),w?(await ce({...e,status:"create"}).then(()=>{T.success(s("notes.response.saveNoteSuccess"))}),M()):(await de({id:c.value.id,...e,status:"save"}).then(()=>{T.success(s("notes.response.saveNoteSuccess"))}),M(m.current)),h.value=!1,n==null||n.emit("fullScreenLoading:hide")}async function q(e){const t=JSON.stringify({title:e.title,content:e.content,topics:e.topics});D!=t&&await S({...e,status:"publish"}),n==null||n.emit("fullScreenLoading:show"),console.log("publish"),U(),n==null||n.emit("fullScreenLoading:hide")}function U(){y.value=!0}function J(){const e=c.value;window.open("https://creator.xiaohongshu.com/publish/publish","_blank"),window.dispatchEvent(new CustomEvent("@p/aprbn:setPublishData",{detail:{data:{type:e.type,title:e.title,content:e.content,topics:e.topics}}}))}function R(e){n==null||n.emit("fullScreenLoading:show"),console.log("deleteNote",e),fe({id:e.id}).then(()=>{T.success(s("notes.response.deleteNoteSuccess")),n==null||n.emit("fullScreenLoading:hide"),M(m.current)})}function Y(e){const{commodityInfo:t,...l}=e;return JSON.stringify(l)}function j(e){const t=new Date;t.setHours(0,0,0,0);const l=new Date(e);l.setHours(0,0,0,0);const u=(l.getTime()-t.getTime())/(1e3*3600*24);return u<0||u>7}const I=function(){const e=(l,a)=>{const u=[];for(let d=l;d<a;d++)u.push(d);return u},t=l=>{const a=new Date,u=l.getDate(),d=a.getDate();var v=[];if(u===d){const _=new Date(a.getTime()+36e5);v=[[0,0],[_.getHours(),_.getMinutes()+1]]}else{const _=new Date(a.getTime()+6048e5);u===_.getDate()&&l.getMonth()===_.getMonth()?v=[[a.getHours(),a.getMinutes()],[24,60]]:v=[[0,0],[0,0]]}return v};return l=>{const[[a,u],[d,v]]=t(l);return{disabledHours:()=>e(a,d),disabledMinutes:()=>e(u,v)}}}();return(e,t)=>{const l=pe,a=ve,u=ge,d=_e,v=he,_=be,K=me;return L(),C(P,null,[f("section",Ne,[f("section",we,[f("span",null,g(o(s)("notes.title")),1)]),i(o(z),{onChange:E,placeholder:o(s)("notes.searchPlaceHolder"),filterConditionList:k.value},null,8,["placeholder","filterConditionList"]),f("div",De,[f("span",Me,g(o(s)("notes.label.info")),1),f("span",Le,g(o(s)("notes.label.desc")),1),f("span",null,g(o(s)("notes.label.commodityInfo")),1),f("span",null,g(o(s)("notes.label.operate")),1)]),f("section",Te,[ae(i(o(A),{"blur-bg":!0},null,512),[[le,o(V)]]),(L(!0),C(P,null,ie(H.value,r=>(L(),re(o(W),{key:Y(r),"note-info":r,onPublishNote:$,onDeleteNote:R},null,8,["note-info"]))),128))]),i(o(X),{"current-page":o(m).current,"onUpdate:currentPage":t[0]||(t[0]=r=>o(m).current=r),total:o(B)},{left:p(()=>[i(o(G),{onClick:O},{default:p(()=>[i(o(Q),{name:"plus"}),f("span",null,g(o(s)("notes.createNoteBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),i(l,{visible:h.value,footer:!1,placement:"right",unmountOnClose:"",title:N.value,onCancel:t[2]||(t[2]=r=>h.value=!1)},{default:p(()=>[i(o(Z),{"note-info":c.value,onCancel:t[1]||(t[1]=r=>h.value=!1),onPublish:q,onSave:S},null,8,["note-info"])]),_:1},8,["visible","title"]),i(K,{visible:y.value,"onUpdate:visible":t[5]||(t[5]=r=>y.value=r),title:o(s)("notes.publishInfoModelTitle"),onCancel:t[6]||(t[6]=r=>y.value=!1),onOk:J},{default:p(()=>[i(_,{model:c.value},{default:p(()=>[i(d,{field:"type",label:o(s)("notes.noteModel.typeLabel")},{default:p(()=>[i(u,{modelValue:c.value.type,"onUpdate:modelValue":t[3]||(t[3]=r=>c.value.type=r)},{default:p(()=>[i(a,{value:"word"},{default:p(()=>[x(g(o(s)("notes.noteModel.type.word")),1)]),_:1}),i(a,{value:"video"},{default:p(()=>[x(g(o(s)("notes.noteModel.type.video")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(d,{field:"date",label:o(s)("notes.noteModel.dateLabel")},{default:p(()=>[i(v,{modelValue:c.value.date,"onUpdate:modelValue":t[4]||(t[4]=r=>c.value.date=r),"show-time":"",format:"YYYY-MM-DD hh:mm",timePickerProps:{hideDisabledOptions:!0},disabledDate:j,disabledTime:o(I)},null,8,["modelValue","disabledTime"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}}),Oe=ee(Se,[["__scopeId","data-v-ce4bf943"]]);export{Oe as default};
