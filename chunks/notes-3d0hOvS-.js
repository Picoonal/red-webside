import{F as $,L as D,N as I,P as M,_ as V,b as J,E as K,a as O}from"./comp-libs-kaq5mMGe.js";import{u as R}from"./useRequestList-zzeLWAwj.js";/* empty css              */import{d as U,i as j,r as p,c as H,h as y,l,M as f,_ as s,u as r,J as z,K as A,F as L,N as G,B as v,f as _,p as Q}from"./vue-vendor-13TjpPhz.js";import{d as W,f as X,h as Y,i as Z}from"./api-libs-B_1UTR2a.js";import{g as ee,M as N}from"./comp-vendor-Va0SXYoc.js";import{u as te}from"./locale-vendor-LTacbNcc.js";import"../assets/index-6d5tK8-d.js";const se={class:"notes-page flex flex-col h-full"},oe={class:"layout-title"},ne={class:"label-bar flex items-center"},ae={class:"flex"},le={class:"mr-4"},ie={class:"note-list flex-1 relative"},re=U({__name:"notes",setup(ue){const{t:o}=te(),t=j("emitter"),C=p(["123","234"]),u=p(!1),d=p({}),m=p("");let h=!1;const{list:w,loading:S,total:x,queryParams:i,forceUpdate:g}=R(W),F=H(()=>w.value.map(e=>({...e,content:e.desc.replace(/{{ENTER}}/g,"\n"),topics:e.tags})));function B(e){const{searchText:n,filterCondition:c}=e;let a=!1;i.query!=n&&(i.query=n,a=!0),i.queryType!=c&&(i.queryType=c,a=!0),a&&(i.current=1)}function P(){m.value=o("notes.formTitle.newNote"),d.value={},h=!0,u.value=!0}function T(e){m.value=o("notes.formTitle.editNote"),d.value=e,h=!1,u.value=!0}async function b(e){console.log("noteInfo",e),t==null||t.emit("fullScreenLoading:show"),h?(await X({...e,status:"create"}).then(()=>{N.success(o("notes.response.saveNoteSuccess"))}),g()):(await Y({id:d.value.id,...e,status:"save"}).then(()=>{N.success(o("notes.response.saveNoteSuccess"))}),g(i.current)),u.value=!1,t==null||t.emit("fullScreenLoading:hide")}async function q(e){await b({...e,status:"publish"}),t==null||t.emit("fullScreenLoading:show"),console.log("publish"),t==null||t.emit("fullScreenLoading:hide")}function E(e){t==null||t.emit("fullScreenLoading:show"),console.log("deleteNote",e),Z({id:e.id}).then(()=>{N.success(o("notes.response.deleteNoteSuccess")),t==null||t.emit("fullScreenLoading:hide"),g(i.current)})}function k(e){const{commodityInfo:n,...c}=e;return JSON.stringify(c)}return(e,n)=>{const c=ee;return _(),y(L,null,[l("section",se,[l("section",oe,[l("span",null,f(s(o)("notes.title")),1)]),r(s($),{onChange:B,placeholder:s(o)("notes.searchPlaceHolder"),filterConditionList:C.value},null,8,["placeholder","filterConditionList"]),l("div",ne,[l("span",ae,f(s(o)("notes.label.info")),1),l("span",le,f(s(o)("notes.label.desc")),1),l("span",null,f(s(o)("notes.label.commodityInfo")),1),l("span",null,f(s(o)("notes.label.operate")),1)]),l("section",ie,[z(r(s(D),{"blur-bg":!0},null,512),[[A,s(S)]]),(_(!0),y(L,null,G(F.value,a=>(_(),Q(s(I),{key:k(a),"note-info":a,onPublishNote:T,onDeleteNote:E},null,8,["note-info"]))),128))]),r(s(J),{"current-page":s(i).current,"onUpdate:currentPage":n[0]||(n[0]=a=>s(i).current=a),total:s(x)},{left:v(()=>[r(s(M),{onClick:P},{default:v(()=>[r(s(V),{name:"plus"}),l("span",null,f(s(o)("notes.createNoteBtn")),1)]),_:1})]),_:1},8,["current-page","total"])]),r(c,{visible:u.value,footer:!1,placement:"right",unmountOnClose:"",title:m.value,onCancel:n[2]||(n[2]=a=>u.value=!1)},{default:v(()=>[r(s(K),{"note-info":d.value,onCancel:n[1]||(n[1]=a=>u.value=!1),onPublish:q,onSave:b},null,8,["note-info"])]),_:1},8,["visible","title"])],64)}}}),_e=O(re,[["__scopeId","data-v-506cbbe4"]]);export{_e as default};
